<!-- переменные -->
[elementor-editorbutton]: https://i.imgur.com/F25PIBd.png
[elementor-module]: https://i.imgur.com/nl9yD1G.png
[elementor-shortcode]: https://i.imgur.com/AMyvqu0.png
[mediagallery]: https://i.imgur.com/iK4yOtn.png

# Как работать с beta.miners-moss.ru
> Если есть необходимость **редактировать файлы темы**, то сначала нужно установить эту сборку на свой компьютер. Если достаточно будет менять данные через панель **администратора wordpress** то пункт установки сборки можно пропустить:

## Установка сборки

У вас должны быть установлены [Node.js](https://nodejs.org/en/) и [Git](https://git-scm.com/)

В Windows лучше использовать не стандартый терминал а какую-нибудь альтернативную оболочку. например [conEmu](http://conemu.ru/ru/) или [cmder](http://cmder.net/)

в Mac есть [iTerm2](https://www.iterm2.com/)

В терминале заходим в желаемую папку

**Пишем:**

`git clone https://github.com/MrRaccoon58/minersTheme`

`cd minersTheme`

`npm install`

`mv _gulpfile.js gulpfile.js`

Открываем проект через редактор кода.

`gulp`

## Работа с панелью администратора wordpress

Весь процесс работы построен на принципе что "Все может поменяться". Чтобы в будущем, когда нужно будет найти какую-то страницу или изображение на сервере; пересортировать или поменять пункты главного меню; изменить какой-нибудь типовой элемент, чтобы он поменялся на всем сайте разом.

Так же нам нужен способ чтобы легко и быстро создавать адаптивные типовые страницы или адаптивить существующие.

Стандартные средства Wordpress не располагают такими возможностями. Именно для того чтобы сократить время своей работы мы будем пользоваться плагинами.

Плагины с которыми нужно работать и их описание:

    1. Elementor
    2. TablePress (Нашел другой плагин. Supsystic Tables `TODO: Переделать ридми под него`)
    3. WP Real Media Library
    4. Nested Pages
    5. Max Mega Menu

<!-- ## TablePress

Нужен для создания таблиц. Нам он полезен в первую очередь тем, что с его помощью можно создавать адаптивные для разных экранов таблицы. Даже если таблица большая и в ней много данных мы можем уместить ее в экран разными способами (разбиение таблицы на страницы, горизонтальный скролл в пределах таблицы)

Плагин полезен так же тем, что можно легко отстилизовать как все таблицы одновременно, так и одну конкретную таблицу.

Таблицы вставляются на сайт с помощью шорткодов и их легко вставить через elementor а одна и та же таблицы может  быть переиспользована в нескольких местах при необходимости (опять же - изменив данные в одной, они поменяются в обеих таблицах)

Сами таблицы создаются и редактируются из админки Wordpress - меню Tablepress. Таблицу можно создать прямо там, а можно импортировать (создать в excel и сохранить как csv файл или самому написать JSON файл)
___ -->

## WP Real Media Library | Nested Pages | Max Mega Menu

Это технические плагины которые нужны для структуризации, удобного просмотра и поиска контента в админке.

### WP Real Media Library

Стандартная галлерея Wordpress - это просто меню где отображаются все загруженные на сервер медиафайлы одним списком. Этот плагин дополняет стандартную галлерею боковым меню с древовидной структурой, папками и поиском. основной принцип в том, что мы:

`соблюдаем иерархию и именуем папки так же как они расположены в меню`.

Благодаря этому мы всегда точно знаем где лежит конкретное изображение и можем быстро ориентироваться.

у этого решения есть один минус: если на двух разных страницах используется одно и то же изображение, то и в структуре папок оно будет дублироватья.

как исправить:

* Использовать другой способ сортировки медиа.
* Запоминать где используются одинаковые изображения и на странице ссылаться на одну, более "приоритетную" папку.
* переработать структуру страниц и сайтов полностью, потому что на хороших сайтах не используется одно и то же изображение товара в разных местах без веской причины

Но в данный момент используется иерархический подход, поэтому пока рекомендую использовать именно его.

### Nested Pages

Позволяет создать иерархию страниц сайта. т.е. то, как страница будет отображаться в адресной строке браузера (пример: `site.ru/page/subpage`)

Проблема в том, что на старом miners-moss все страницы расположены на первом уровне вложенности и если поменять эту структуру, сайт может на какое-то время упасть в поисковиках потому что результаты поиска будут выдавать более несуществующие ссылки,  пока страницы заново не пориндексируются.

Поэтому было принято решение пока сохранить структуру старых страниц прежней, но новые страницы создавать с учетом иерархии (новые страницы продукции следует помещать по пути `production/pagename`; страницы статей - по пути `articles/pagename` и так далее)

Старые страницы можно будет реструктуризировать постепенно, чтобы падение в поисковаках не было слишком сильным, предварительно посоветовавшись с SEO специалистом.

### Max Mega Menu

В данный момент меню по своей структуре просто скопировано со старого сайта + сделан адаптивный вариант для мобильных. Само меню можно менять в разделе Apperance -> Menus. оно поддерживает иерархию и не зависит от порядка наследуемых страниц.

меню пунктов берется из названия самой страницы
___

## Elementor

> Очень важно! когда будете изучать этот пункт, откройте сайт и попробуйте создать тестовую страницу по примеру - так все будет намного понятнее

Встроенный редактор Wordpress отлично справляется с созданием текстовых страниц и веб-документов так как у него есть все или почти все основеые функции которыми обладает Microsoft Word. К сожалению этот редактор не подойдет в том случае если нам нужно создать адаптивное содержимое веб-страницы которое должно отличаться документа созданного в офисном приложении.

Первое очевидное решение - встроенный редактор кода. Но у него несколько существенных минусов:

    1. он не поддерживает автозавершение строк и подсветку синтаксиса (исправляется установкой плагина но от всех проблем это не спасает)

    2. При смене режима отображения (визуальный редактор/код) wordpress почти всегда автоматически меняет код, удаляет переносы строк и часто ломает то, что написано руками.

    3. переиспользовать код можно только одним образом: открыть страцицу донора, найти код нужного элемена (помним о том что это может быть без подсветки синтаксиса и с удаленными переносами строк) скопировать нужный кусок кода, открыть страницу реципиент и  найти в ее коде нужное место куда вставить код.

    4. Нужно помнить про адаптивность. и задавать ее либо общими стилями в основном файле css, либо для каждой страницы отдельно.

    5. Писать код руками - очень медленно. Особенно в том случае когда нам нужно обработать несколько (десятков) страниц

Основной проблемой в первую очередь всегда будет оставаться скорость работы. Страницы менять нужно быстро и не боясь при этом поломать какой-то важный кусок верстки.

Имеено по этим причинам мы будем использовать плагин для создания страниц в Wordpress - Elementor.

Он позволяет верстать таблицы с помощью блоков. Получаемая страница, даже при самой простейшей сборке, сразу же получается адаптированой для мобильных.

Так же есть возможность сохранять части страниц в "шаблоны" для дальшейшего переиспользования повторяющихся частей страницы  в разных местах. есть много встроенных модулей типа вставки шорткодов, галерей, каруселей, прогресс баров, нумерованых списков и много чего еще.

чтобы соблюдать однотипность страниц и гарантировать их адаптивность, мы собираем страницы

`только с помощью Elementor`

### Как создать страницу с помощью Elementor

 Заходим в режим редактирования страницы либо через админку (Pages > edit) либо открываем нужную страницу на сайте и выбираем в панели администратора  `Edit Page`

 Удаляем контент страницы из встроенного редактора (если есть)

 нажимаем кнопку

![elementor][elementor-editorbutton]

После этого откроется визуальный редактор Elementor.

 Заголовок H1 на странице проставляется автоматически - он равен названию страницы, соответственно чтобы его изменить - меняем название самой страницы в меню `Pages`.

 Чтобы создать новую секцию, нужно нажать в рабочей области кнопку `ADD NEW SECTION`, либо выбрать элемент из списка слева и перенести его в рабочую область

 > &nbsp;![elementor][elementor-module]&nbsp;
 >
 > 1 -  Меню управления колонкой. При нажатии на него, в левой панели можно изменить настройки колонки, при наведении - можно поменять количество колонок в секции
 >
 > 2 - Меню управления секцией. При нажатии - в левой панели появляются настройки секции. с помощью кнопок в самом меню можно: перемещать секцию, копировать секцию, добавить новую, а так же можно сохранить "шаблон" созданной секции для переиспользования в дальнейшем
 >
 > 3 - меню управления элементом. При нажатии - настройки в панели правления. При наведении можно скопировать элемент внутри секции, удалить ли перемещать между разными секциями на странице

 чтобы добавить ранее сохраненный шаблон в рабочей области нажимаем на кнопку `ADD TEMPLATE`. В открывшемся меню выбираем сверху вкладку `My Templates`. чтобы посмотреть как выглядит шаблон нажимаем на `preview`, чтобы вставить шаблон на страницу - нажимаем на `insert`

 > в том случае если нам нужно вставить ссылку на страницу, для нее мы пишем `относительный путь`, а не абсолютный
 >
 > beta.miners-moss.ru/pagename - не правильно
 >
 > /pagename - правильно
 >
 >Это нужно для того, что когда сайт переезжает на новый домен - ссылка осталась рабочей

 часто нам потребуется вставка типовых элементов посредством шорткодов. для этого перетаскиваем в рабочую область элемент `Shortcode`

&nbsp;![elementor][elementor-shortcode]&nbsp;

 для сохранения результатов нажимаем на кнопку `UPDATE` в панели управления, для предварительного просмотра - нажимаем на иконку `глаза` (предпросмотр откроется в новой вкладке)

Этих базовых знаний должно хватить для того чтобы начать собирать адаптивные страницы для сайта. Для больших подробностей, а так же для решения вопросов в процессе, у Elementor есть подробная документация: <https://docs.elementor.com/>
___

## Процедура переноса страниц из старого miners-moss в новый

* проверка ссылки
* сохранение картинок
* добавление картинок в медиагалерею
* Создание таблицы
* удаление контента импортированной страницы
* редактирование с помощью elementor
  * вставка таблиц (если имеются)
  * сохранение
* проверка отображения на разных устройствах

### проверка ссылки

Нам нужно убедиться в том, что пути к страницам на старом и новом сайте абсолютно одинаковые. это нужно потому что если мы поменяем структуру ссылок,  в поисковаках по нужным нам запросам  до того как страницы заново не проиндексируются будут выдавать результаты на несуществующие страницы.

чтобы убедиться что структура на старом и новом сайте правильная, первое что мы делаем это открываем страницу которую мы собираемся перенести

Например
> <http://beta.miners-moss.ru/kovry-drazhnye/>

удаляем все, что стоит до названия сайта:

> miners-moss.ru/kovry-drazhnye/

переходим по ссылке. Если мы попали на ту же самую страницу, но на старом сайте - значит мы все сделали праавильно. если нет - исправляем путь страницы на новом сайте чтобы он совпадало с путем на старом

### Сохранение картинок

в данный момент основная задача - просто перенести страницы со старого сайта на новый. сохраняем все картинки со старой страницы которую мы открыли в предыдущем пункте. Можно делать это вручную, но в этом хорошо помогает расширение для Хрома [Image Downloader](https://chrome.google.com/webstore/detail/image-downloader/cnpniohnfphhjihaiiggeabnkjhpaldj)

### Добавление картинок в медиагалерею

Сохранять картинки на свой компьютер можно куда удобно, но при добавлении в медиагаллерею нужно стараться сохранять иерархию:

![gallery][mediagallery]

Папки внутри Продукции в основном названы по именам страниц. Там где это допустимо можно использовать короткое понятное имя (например подкатегории дражных ковров)

### Создание таблицы

Если на копируемой странице присутствует таблица, то будет проще сразу ее создать, чтобы при наполнении контентом новой страницы, просто вставить таблицу через шорткод

### Удаление контента импортированной страницы

уже писалось выше но лучше еще раз: контент импортированной страницы из встроенного редактора страницы (не elementor) удаляем (`Выделить всё -> del -> Update`)

### Редактирование с помощью elementor

Пересобираем нашу новую страницу на основе плагина Elementor:

вставляем скачанные картинки. если на странице много однотипных картинок принадлежащих одной секции, допускается использование таких модулей как галлерея или карусель для того чтобы уменьшить длину страницы

Если редактируемая страница относится к разделу продукции, то в самом низу страницы вставляем форму отправки заявки с помощью `ADD TEMPLATE - My Templates - PRODUTCION FORM`

Если видим что какой-то однотипный элемент используется несколько раз на странице или на нескольких страницах - сохраняем его как шаблон (иконка дискеты на настройках секции) и переиспользуем там где нужно. не переверстываем по нескольку раз одно и то же

#### вставка таблиц (если имеются)

Вставляем на страниу таблицы с помощью элемента Shortcode

#### сохранение

Нажимаем на Update чтобы сохранить все что мы сделали

### проверка отображения на разных устройствах
есть несколько способов:

1. В Elementor встроен инструмент отображения на разных устройствах (`иконка монитора` рядом с кнопкой `update`)

1. Инспектор в браузере - в нем тоже есть вариант отображения страницы с разных устройств - более реалистичный чем встроенный в elementor инструмент. открывается инспектор на F12 в Windows или ⌥⌘I на Mac

1. Но само собой лучше всего будет  проверить что все нормально отображается, не вылазит за пределы контейнера и не ломает верстку на реальном устройстве